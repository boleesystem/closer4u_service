<%- include('includes/head.ejs') %>
  <main>
    <h2>주문접수내역</h2>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">세탁물 사진</th>
          <th scope="col">신청일자</th>
          <th scope="col">닉네임</th>
          <th scope="col">배송지</th>
          <th scope="col">요청사항</th>
          <th scope="col">주문상태</th>
          <th scope="col">리뷰</th>
        </tr>
      </thead>
      <tbody>
        <% for (let data of datas) { %>
          <tr>
            <th scope="row">
              <img src="<%= data.image%>">
            </th>
            <td>
              <%= data.date%>
            </td>
            <td>
              <%= data.nickname%>
            </td>
            <td>
              <%= data.address%>
            </td>
            <td>
              <%= data.requested%>
            </td>
            <td>
              <% if (member===1) { %>
                <% switch (data.status) { case 1: %>
                  <button type="button" class="btn btn-secondary status-change" value="<%= data.id %>">수거 중</button>
                  <% break; case 2: %>
                    <button type="button" class="btn btn-secondary status-change" value="<%= data.id %>">수거 완료</button>
                    <% break; case 3: %>
                      <button type="button" class="btn btn-secondary status-change" value="<%= data.id %>">배송 중</button>
                      <% break; case 4: %>
                        <button type="button" class="btn btn-secondary status-change" value="<%= data.id %>">배송
                          완료</button>
                        <% break; default: break; } %>
                          <% } else { %>
                            <% switch (data.status) { case 1: %>
                              <button type="button" class="btn btn-secondary status-change" disabled
                                value="<%= data.id %>">수거
                                중</button>
                              <% break; case 2: %>
                                <button type="button" class="btn btn-secondary status-change" disabled
                                  value="<%= data.id %>">수거
                                  완료</button>
                                <% break; case 3: %>
                                  <button type="button" class="btn btn-secondary status-change" disabled
                                    value="<%= data.id %>">배송 중</button>
                                  <% break; case 4: %>
                                    <button type="button" class="btn btn-secondary status-change" disabled
                                      value="<%= data.id %>">배송
                                      완료</button>
                                    <% break; default: break; } %>
                                      <% } %>
            </td>
            <td>
              <% if (data.Reviews[0]) { %>
                <%= "⭐" .repeat(data.Reviews[0].mark) %><br>
                  <%= data.Reviews[0].comment %>
                    <% } else { %>
                      <% if (member===0 && data.status===4) { %>
                        <button type="button" class="btn btn-secondary order-accept <%= userId%>"
                          value="<%= data.id %>">리뷰
                          작성</button>

                        <% } else { %>
                          <button type="button" class="btn btn-secondary order-accept <%= userId%>" disabled
                            value="<%= data.id %>">리뷰
                            작성</button>
                          <% } %>
                            <%}%>
            </td>
          </tr>
          <% } %>
      </tbody>
    </table>
  </main>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const accept_btn = document.getElementsByClassName('status-change');
      for (let i = 0; i < accept_btn.length; i++) {
        accept_btn[i].addEventListener('click', () => {
          const orderId = accept_btn[i].value
          console.log('/api/orders/' + orderId)
          axios({
            method: 'put',
            url: '/api/orders/' + orderId,
            data: {}
          }).then((response) => {
            console.log(response.status);
            window.location.href = '/api/orders'
          }).catch((response) => {
            console.log(response.errorMessage);
            window.location.href = '/api/orders'
          })
        })
      }
    })
  </script>

  </html>